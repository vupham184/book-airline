function createTip(){new jmootips({container:null,focus:false,hovered:".jmootipper",ToolTipClass:"jmootips",toolTipPosition:-1,showDelay:250,openOnClick:false,sticky:false,stickyHover:false,fromTop:10,fromLeftRight:5,arrowFromTop:0.4,arrowFromLeft:0.45,closeMsg:"Close",loadingMsg:"Loading... please wait.",failMsg:"<b>Error:</b> Could not load content",duration:200,fadeDistance:50});}var jmootips=new Class({Implements:[Options],options:{container:null,hovered:".jmootipper",ToolTipClass:"jmootips",focus:false,toolTipPosition:-1,showDelay:250,openOnClick:false,sticky:false,stickyHover:true,fromTop:12,fromLeftRight:12,arrowFromTop:0.4,arrowFromLeft:0.45,closeMsg:"Close",loadingMsg:"Loading... please wait.",failMsg:"Error: Could not load content",duration:200,fadeDistance:50},initialize:function(options){this.setOptions(options||null);if(!this.options.hovered){return;}if(this.options.hovered){this.elements=$(this.options.container||document.body).getElements(this.options.hovered);}if(this.elements==undefined){this.elements=new Array();}this.currentElement=null;this.attach();},attach:function(){this.elements.each(function(elem,key){var parms=new Hash(JSON.decode(elem.getProperty("rel")));parms.include("visible",0);if(parms.sticky!=undefined){var sticky_parm=parms.sticky;}else{var sticky_parm=this.options.sticky;}if(this.isMobile()){sticky_parm=true;this.options.sticky=true;parms.sticky=true;}var tooltip=this.createContainer(sticky_parm,parms.title,parms.position||this.options.toolTipPosition);if(parms.title){tooltip.title.set({"html":parms.title});}if(parms.text){tooltip.message.set({"text":parms.text});}if(parms.content){tooltip.message.set({"html":$(parms.content).get("html")});}if(parms.ajax){tooltip.message.set({"html":parms.ajax_message||this.options.loadingMsg});new Element("div",{"class":"loading"}).inject(tooltip.message);}if(!parms.position){parms.position=this.options.toolTipPosition;}tooltip.container.store("properties",parms);elem.store("tip",tooltip.container);$(document.body).adopt(tooltip.container);elem.removeProperties("title","rel");if(this.isMobile()){parms.openOnClick=true;this.options.openOnClick=true;}if(parms.openOnClick||this.options.openOnClick){if(parms.openOnClick!=false){var startEvent=parms.focus?"focus":"click";}else{var startEvent=parms.focus?"focus":"mouseenter";}}else{var startEvent=parms.focus?"focus":"mouseenter";}var endEvent=parms.focus?"blur":"mouseleave";elem.addEvent(startEvent,function(e){this.enter(e,elem);}.bind(this));tooltip.container.addEvent(endEvent,function(e){this.leave(e,tooltip.container);}.bind(this));elem.addEvent(endEvent,function(e){this.leave(e,tooltip.container);}.bind(this));if((parms.stickyHover||this.options.stickyHover)&&!(parms.sticky||this.options.sticky)){tooltip.container.addEvent("mouseleave",this.hide.pass(tooltip.container).bind(this));}if(parms.sticky||this.options.sticky){if(parms.sticky!=false){tooltip.close.addEvent("click",this.hide.pass(tooltip.container).bind(this));}else{tooltip.container.addEvent("mouseleave",this.hide.pass(tooltip.container).bind(this));}}},this);},enter:function(event,element){var tip=element.retrieve("tip");var elProperties=tip.retrieve("properties");if(elProperties.visible==1&&elProperties.loaded==1){return;}var tip_position=elProperties.position||this.options.toolTipPosition;if(elProperties.ajax&&!elProperties.loaded){var failmsg=this.options.failMsg;var open_option=elProperties.openOnClick||this.options.openOnClick;new Request.HTML({url:elProperties.ajax,onSuccess:function(a,b,responsetext){tip.getElement(".message").set("html",responsetext);elProperties.set("loaded",1);elProperties.set("visible",0);element.focus();if(open_option){element.fireEvent("click");}else{element.fireEvent("mouseenter");}},onFailure:function(xhr){failmsg=failmsg+" - "+"Error "+xhr.status+" ("+xhr.statusText+"):<br /> "+elProperties.ajax;tip.getElement(".message").set("html",failmsg);elProperties.set("loaded",1);elProperties.set("visible",0);if(open_option){element.fireEvent("click");}else{element.fireEvent("mouseenter");}},}).get();}else{elProperties.set("loaded",1);}var showAfter=elProperties.target?$(elProperties.target):element;var elSize=showAfter.getCoordinates();var tipSize=tip.getCoordinates();var adjustment=10;if(showAfter.get("tag")=="a"){if(showAfter.getStyle("height").toInt()){var height=showAfter.getStyle("height").toInt();if(tip_position==-2||tip_position==2){elSize.top=elSize.top+parseInt(height/2)-this.options.fromTop;}}}if(showAfter.get("tag")=="img"){var src=showAfter.getProperty("src");var chkImage=new Image();chkImage.src=src;elSize.width=showAfter.getProperty("width")||chkImage.width;var height=showAfter.getProperty("height")||chkImage.height;if(showAfter.getProperty("width")!=null&&showAfter.getProperty("height")==null){height=parseInt(chkImage.height*showAfter.getProperty("width")/chkImage.width);}if(showAfter.getProperty("height")!=null&&showAfter.getProperty("width")==null){elSize.width=parseInt(chkImage.width*showAfter.getProperty("height")/chkImage.height);}if(tip_position==-2||tip_position==2){elSize.top=elSize.top+parseInt(height/2)-this.options.fromTop;}}if(showAfter.get("tag")=="area"){var shape=showAfter.getProperty("shape");var coords=showAfter.getProperty("coords");coords=coords.split(",");elSize.width=parseInt(parseInt(coords[2])-parseInt(coords[0]))/2;elSize.right=elSize.left+parseInt(coords[2]);elSize.left=elSize.left+parseInt(coords[0]);elSize.height=parseInt(coords[3])-parseInt(coords[1]);if((tip_position==-2||tip_position==2)){elSize.top=elSize.top+parseInt(coords[1])+elSize.height/2-this.options.fromTop;}else{elSize.top=elSize.top+parseInt(coords[1]);}}this.fromTop=0;if(tip_position==-1||tip_position==1){if(tip_position==-1){this.fromTop=elSize.top-this.options.fromTop-tipSize.height;}else{this.fromTop=elSize.top+this.options.fromTop+elSize.height;}var top_dist=this.fromTop+(elProperties.position||this.options.toolTipPosition)*this.options.fadeDistance;var left_dist=elSize.left-adjustment+parseInt(elSize.width/2)-parseInt(tipSize.width*this.options.arrowFromLeft);}else{this.fromTop=elSize.top-4-parseInt(tipSize.height*this.options.arrowFromTop);var top_dist=this.fromTop+(elProperties.position||this.options.toolTipPosition)*(this.options.fadeDistance/2);if(tip_position==-2){var left_dist=elSize.right+this.options.fromLeftRight;}else{var left_dist=elSize.left-(tipSize.width+this.options.fromLeftRight);}}tip.setStyles({"top":top_dist,"left":left_dist,"visibility":"visible"});elProperties.set("leave",top_dist);this.currentElement=tip;this.timer=clearTimeout(this.timer);this.timer=this.show.delay(this.options.showDelay,this);},leave:function(event,element){var elProperties=element.retrieve("properties");if(elProperties==null){return;}if((elProperties.sticky||this.options.sticky)&&elProperties.visible){if(elProperties.sticky!==false){return;}}if((elProperties.stickyHover||this.options.stickyHover)&&elProperties.visible){if(elProperties.stickyHover!==false){if(this.isHovered(event,element)){return;}else{this.hide(element);}}}this.hide(element);},isHovered:function(event,element){var tipSize=element.getCoordinates();if((event.page.x+20>tipSize.left&&event.page.x-20<tipSize.right)&&(event.page.y+20>tipSize.top&&event.page.y-20<tipSize.bottom)){return true;}else{return false;}},hide:function(element){this.timer=clearTimeout(this.timer);var elProperties=element.retrieve("properties");if(elProperties==null){return;}element.morph({"opacity":0,"top":elProperties.leave});element.setStyles({"visibility":"hidden","z-index":"-10000","opacity":0,});elProperties.visible=0;},show:function(){this.currentElement.setStyles({"display":"block","opacity":0,"visibility":"visible","z-index":"10000"});this.currentElement.morph({"opacity":1,"top":this.fromTop});this.setVisible.delay(this.options.duration,this);this.setVisible();},setVisible:function(){var elProperties=this.currentElement.retrieve("properties");elProperties.visible=1;},isMobile:function(){var up=navigator.userAgent.toLowerCase();var isMobilePlatform=/(iPad|iPhone|iPod|adroid|webos|cros|cromium)/i.test(up);if(isMobilePlatform){return true;}var ua=navigator.userAgent;var isKindle=/(Kindle|Silk|KFTT|KFOT|KFJWA|KFJWI|KFSOWI|KFTHWA|KFTHWI|KFAPWA|KFAPWI)/i.test(ua);if(isKindle){return true;}if(navigator.userAgent.match(/Opera Mini/i)||navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/BlackBerry/i)){return true;}return false;},createContainer:function(sticky,title_content,position){var container=new Element("div").set({"class":this.options.ToolTipClass,"styles":{"position":"absolute","top":0,"left":0,"opacity":0,"z-index":"-10000","visibility":"hidden"},"morph":{duration:this.options.duration,link:"cancel",transition:Fx.Transitions.Sine.easeOut}});if(title_content){var title=new Element("div",{"class":"title"}).inject(container);}if(sticky){var closeBtn=new Element("div",{"class":"sticky_close","title":this.options.closeMsg}).inject(container);}var message=new Element("div",{"class":"message"});container.adopt(message);switch(position){case -1:var arrow_class="arrow_below";break;case 1:var arrow_class="arrow_above";break;case -2:var arrow_class="arrow_left";break;case 2:var arrow_class="arrow_right";break;default:var arrow_class="arrow_above";}var arrow=new Element("div",{"class":arrow_class}).inject(container,"top");return{"container":container,"title":title||null,"message":message,"close":closeBtn||null};}});